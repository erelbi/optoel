{% load static %}
{% block manometre %}
<style>
  .gerisayim{
    list-style: none;
    display: block;
  }
  .gerisayim li{
    display: inline-block;
    padding: 10px;
    background: lightgray;
    font-size: 24px;
  }
  .glyphicon-ok{
    float: right;
    color: green;
  }
  .glyphicon-refresh-animate {
    -animation: spin .7s infinite linear;
    -webkit-animation: spin2 .7s infinite linear;
    float: right;
  }
  #adimlar li span {
    float: right;

  }
  @-webkit-keyframes spin2 {
      from { -webkit-transform: rotate(0deg);}
      to { -webkit-transform: rotate(360deg);}
  }

  @keyframes spin {
      from { transform: scale(1) rotate(0deg);}
      to { transform: scale(1) rotate(360deg);}
  }
  .indicator-cont{
    width: 100%;
    border-radius: 5px;
    font-weight: 500;
    border: 2px solid black;
    background: ;
    height: 40px;
    line-height: 34px;
    font-size: 18px;
    color: #000;
    padding: 0 6px;
  }
  .birim{
    float: right;
  }
</style>
<form class="form-inline">
  <!--
  <div class="col-md-2">
      <button class="btn btn-primary" style="width: 80px;height: 80px;border-radius: 50%;padding:0;" id="hv_connect">BAĞLAN</button>
  </div>
  -->
  <!--
  <div class="col-md-2">
      <button class="btn btn-primary" style="width: 80px;height: 80px;border-radius: 50%;margin-left: 20px;padding: 0;" id="hv_start">BAŞLAT</button>
  </div>
  -->

  <!--
  <div class="col-md-2">
      <button class="btn btn-danger" style="width: 80px;height: 80px;border-radius: 50%;margin-left: 40px;padding: 0;" id="hv_bitir">BİTİR</button>
  </div>
  -->
  <!--

  -->

</form>
<div class="row mt-4">
<form class="col-md-10" onsubmit = "event.preventDefault();" id="havuzTestForm">
  
  <!-- 1. Satır -->
  <div id="addableField">
      <div class="form-row">
        <div class="col-md-2 text-center">Seri no</div> 
        <div class="col-md-1 text-center">Uygun</div>
        <div class="col-md-2 text-center">Uygun değil</div>
        <div class="col-md-2 text-center">Tüp Cidar Sıcaklığı</div>
        <div class="col-md-2 text-center">Tüp Basıncı</div>
        <div class="col-md-3 text-center">Sebep</div>

        <div class="form-group col-md-2">
            <input type="text" class="form-control addInput" onkeyup="addSubmit(event)"  id="seri_no_1"  name="vsn">
        </div>
         
        <div class="form-group col-md-1 text-center">
            <input name="havuz-uygunluk_1" id="uygunluk_1" data-degil="true" type="radio">
        </div>


        <div class="form-group col-md-2 text-center">
            <input name="havuz-uygunluk_1" id="uygunlukdegil_1" data-degil="" type="radio" checked>
        </div>


        <div class="form-group col-md-2">
            <input type="text" id="sicaklik_1"  value=0  class="form-control havuz_acma">
        </div>

        <div class="form-group col-md-2">
            <input type="text" id="basinc_1" value=0 class="form-control havuz_kapatma">
        </div>

        <div class="form-group col-md-3 text-center"   >
            <select class="form-control"  id="sebep_1">
                <option >Alt-Üst Nipel arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Kapak Arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Alt Nipel Arası Kaçak</option>
                <option >Basınç Anahtarı-Alt Nipel Arası Kaçak</option>
                <option >Baçınç Anahtarı Açma Değeri Hatalı</option>
                <option > Baçınç Anahtarı Kapama Değeri Hatalı</option>
                <option >Manometre Alt Nipel Arası Kaçak</option>
                <option > Sibop Alt Nipel Arası Kaçak</option>
            </select>
        </div>
      </div>
    </div>



    <!-- 2. Satır -->
    <div id="addableField">
      <div class="form-row">
        <div class="col-md-2 text-center">Seri no</div> 
        <div class="col-md-1 text-center">Uygun</div>
        <div class="col-md-2 text-center">Uygun değil</div>
        <div class="col-md-2 text-center">Tüp Cidar Sıcaklığı</div>
        <div class="col-md-2 text-center">Tüp Basıncı</div>
        <div class="col-md-3 text-center">Sebep</div>

          <div class="form-group col-md-2">
              <input type="text" class="form-control addInput" onkeyup="addSubmit(event)"  id="seri_no_2"  name="vsn">
          </div>
         
      <div class="form-group col-md-1 text-center">
          <input name="havuz-uygunluk_2" id="uygunluk_2" data-degil="true" type="radio">
      </div>


      <div class="form-group col-md-2 text-center">
          <input name="havuz-uygunluk_2" id="uygunlukdegil_2" data-degil="" type="radio" checked>
      </div>


          <div class="form-group col-md-2">
              <input type="text" id="sicaklik_2"  value=0  class="form-control havuz_acma">
          </div>

          <div class="form-group col-md-2">
              <input type="text" id="basinc_2" value=0 class="form-control havuz_kapatma">
          </div>

          <div class="form-group col-md-3 text-center"   >
              <select class="form-control"  id="sebep_2">
                <option >Alt-Üst Nipel arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Kapak Arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Alt Nipel Arası Kaçak</option>
                <option >Basınç Anahtarı-Alt Nipel Arası Kaçak</option>
                <option >Baçınç Anahtarı Açma Değeri Hatalı</option>
                <option > Baçınç Anahtarı Kapama Değeri Hatalı</option>
                <option >Manometre Alt Nipel Arası Kaçak</option>
                <option > Sibop Alt Nipel Arası Kaçak</option>
              </select>
          </div>
      </div>
    </div>


    <!-- 3. Satır -->
    <div id="addableField">
      <div class="form-row">
        <div class="col-md-2 text-center">Seri no</div> 
        <div class="col-md-1 text-center">Uygun</div>
        <div class="col-md-2 text-center">Uygun değil</div>
        <div class="col-md-2 text-center">Tüp Cidar Sıcaklığı</div>
        <div class="col-md-2 text-center">Tüp Basıncı</div>
        <div class="col-md-3 text-center">Sebep</div>

          <div class="form-group col-md-2">
              <input type="text" class="form-control addInput" onkeyup="addSubmit(event)"  id="seri_no_3"  name="vsn">
          </div>
         
      <div class="form-group col-md-1 text-center">
          <input name="havuz-uygunluk_3" id="uygunluk_3" data-degil="true" type="radio">
      </div>


      <div class="form-group col-md-2 text-center">
          <input name="havuz-uygunluk_3" id="uygunlukdegil_3" data-degil="" type="radio" checked>
      </div>


          <div class="form-group col-md-2">
              <input type="text" id="sicaklik_3"  value=0  class="form-control havuz_acma">
          </div>

          <div class="form-group col-md-2">
              <input type="text" id="basinc_3" value=0 class="form-control havuz_kapatma">
          </div>

          <div class="form-group col-md-3 text-center"   >
              <select class="form-control"  id="sebep_3">
                <option >Alt-Üst Nipel arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Kapak Arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Alt Nipel Arası Kaçak</option>
                <option >Basınç Anahtarı-Alt Nipel Arası Kaçak</option>
                <option >Baçınç Anahtarı Açma Değeri Hatalı</option>
                <option > Baçınç Anahtarı Kapama Değeri Hatalı</option>
                <option >Manometre Alt Nipel Arası Kaçak</option>
                <option > Sibop Alt Nipel Arası Kaçak</option>
              </select>
          </div>
      </div>
    </div>


    <!-- 4. Satır -->
    <div id="addableField">
      <div class="form-row">
        <div class="col-md-2 text-center">Seri no</div> 
        <div class="col-md-1 text-center">Uygun</div>
        <div class="col-md-2 text-center">Uygun değil</div>
        <div class="col-md-2 text-center">Tüp Cidar Sıcaklığı</div>
        <div class="col-md-2 text-center">Tüp Basıncı</div>
        <div class="col-md-3 text-center">Sebep</div>

          <div class="form-group col-md-2">
              <input type="text" class="form-control addInput" onkeyup="addSubmit(event)"  id="seri_no_4"  name="vsn">
          </div>
         
      <div class="form-group col-md-1 text-center">
          <input name="havuz-uygunluk_4" id="uygunluk_4" data-degil="true" type="radio">
      </div>


      <div class="form-group col-md-2 text-center">
          <input name="havuz-uygunluk_4" id="uygunlukdegil_4" data-degil="" type="radio" checked>
      </div>


          <div class="form-group col-md-2">
              <input type="text" id="sicaklik_4"  value=0  class="form-control havuz_acma">
          </div>

          <div class="form-group col-md-2">
              <input type="text" id="basinc_4" value=0 class="form-control havuz_kapatma">
          </div>

          <div class="form-group col-md-3 text-center"   >
              <select class="form-control"  id="sebep_4">
                <option >Alt-Üst Nipel arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Kapak Arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Alt Nipel Arası Kaçak</option>
                <option >Basınç Anahtarı-Alt Nipel Arası Kaçak</option>
                <option >Baçınç Anahtarı Açma Değeri Hatalı</option>
                <option > Baçınç Anahtarı Kapama Değeri Hatalı</option>
                <option >Manometre Alt Nipel Arası Kaçak</option>
                <option > Sibop Alt Nipel Arası Kaçak</option>
              </select>
          </div>
      </div>
    </div>


    <!-- 5. Satır -->
    <div id="addableField">
      <div class="form-row">
        <div class="col-md-2 text-center">Seri no</div> 
        <div class="col-md-1 text-center">Uygun</div>
        <div class="col-md-2 text-center">Uygun değil</div>
        <div class="col-md-2 text-center">Tüp Cidar Sıcaklığı</div>
        <div class="col-md-2 text-center">Tüp Basıncı</div>
        <div class="col-md-3 text-center">Sebep</div>

          <div class="form-group col-md-2">
              <input type="text" class="form-control addInput" onkeyup="addSubmit(event)"  id="seri_no_5"  name="vsn">
          </div>
         
      <div class="form-group col-md-1 text-center">
          <input name="havuz-uygunluk_5" id="uygunluk_5" data-degil="true" type="radio">
      </div>


      <div class="form-group col-md-2 text-center">
          <input name="havuz-uygunluk_5" id="uygunlukdegil_5" data-degil="" type="radio" checked>
      </div>


          <div class="form-group col-md-2">
              <input type="text" id="sicaklik_5"  value=0  class="form-control havuz_acma">
          </div>

          <div class="form-group col-md-2">
              <input type="text" id="basinc_5" value=0 class="form-control havuz_kapatma">
          </div>

          <div class="form-group col-md-3 text-center"   >
              <select class="form-control"  id="sebep_5">
                <option >Alt-Üst Nipel arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Kapak Arası Kaçak</option>
                <option >Emniyet Ventili Gövde-Alt Nipel Arası Kaçak</option>
                <option >Basınç Anahtarı-Alt Nipel Arası Kaçak</option>
                <option >Baçınç Anahtarı Açma Değeri Hatalı</option>
                <option > Baçınç Anahtarı Kapama Değeri Hatalı</option>
                <option >Manometre Alt Nipel Arası Kaçak</option>
                <option > Sibop Alt Nipel Arası Kaçak</option>
              </select>
          </div>
      </div>
    </div>

    
</form>
<!--
<div class="col-md-2" style="padding-left: 0;">
  
  <div class="form-group">
      <input type="text" class="col-md-12" id="temp" value="72" style="margin-bottom: 0px;" disabled>
  </div>
  
  <div class="indicator-cont" style="margin-top:20px;"><span class="indicator" id="valfTestIndicator">00</span><span class="birim">°C</span></div>
</div>
-->
</div>
  <!--
  <ul class="gerisayim p-0 mt-4 col-md-12">
      <li class="minutestest">02</li>
      <li class="secondstest">00</li>
  </ul>
  -->
<hr>
<div class="col-md-4 mx-auto">
     <button type="button" class="btn btn-primary btn-lg" style="height: 34px" id="HavuzTest_SayaciBaslat">Sayacı Başlat</button>
    <button type="button" class="btn btn-success btn-lg "  style="height: 34px" id="kaydetHavuzTest">KAYDET</button>
    <!-- <button type="button" class="btn btn-primary " style="height: 34px" id="HavuzTest_SayaciBaslat">Sayacı Başlat</button> -->

</div>
<script src="{% static 'js/jquery-3.1.1.min.js' %}"></script>
<script src="{% static 'js/sweetalert2.min.js' %}"></script>

<!-- havuz test başlangıç -->
<script type="text/javascript">
    // $('input[type=radio]').change(function(){
    //           this.parentElement.parentElement.lastElementChild.children[0].disabled = !this.parentElement.parentElement.lastElementChild.children[0].disabled;
    //         })
</script>

<script type="text/javascript">

  function addSubmit(e){
    if (e.keyCode === 13 && e.target.value){

    }
     


  }


</script>

<script type="text/javascript">

  
  let btn_HavuzTest_SayaciBaslat = document.getElementById('HavuzTest_SayaciBaslat');

  

  document.getElementById('HavuzTest_SayaciBaslat').addEventListener('click', function(e){
      e.preventDefault();
      var el = e.target;
      el.disabled = true;

      $.ajax({
          type: "POST",
          url: 'http://localhost:5000/HavuzTest_start',
          timeout: 3000,
          success: function(x){
              if(x == 'success'){
                  toastr['success']("Test Başladı.");
                  testStatus = "basladi";

                  Timer_HavuzTest_TestStatus = setInterval(Timer_HavuzTest_TestStatusEventHandler, 2000);
              }
              else if(x == 'fail'){
                  toastr["warning"]("Bir hata oluştu");
                  el.disabled = false;
              }
          },
          error(jqXHR, textStatus){
              el.disabled = false;
              toastr["warning"]("Bağlantı hatası! Uygulmananın çalışır durumda olduğundan emin olunuz!");
              console.log(jqXHR);
          }
      });
  });
  

  var testStatus = "None";

  function Timer_HavuzTest_TestStatusEventHandler(){
      $.ajax({
          type: "POST",
          url: 'http://localhost:5000/HavuzTest_TestStatus',
          timeout: 3000,
          success: function(x){
              if(x == 'bitti' && testStatus == 'basladi'){
                  toastr["success"]("Test işlemi bitti.");
                  testStatus = "bitti";
                  
              }
              else if(x == 'None'){
                  testStatus == "None";
                  clearInterval(Timer_HavuzTest_TestStatus);
                  btn_HavuzTest_SayaciBaslat.disabled = false;
              }
          }
      });
  };
  


</script>





<script type="text/javascript">
    document.getElementById('kaydetHavuzTest').addEventListener('click',(e)=>{
      Swal.showLoading();
      e.preventDefault();
      console.log('kaydetHavuzTest')

      var veri = new Array(5);
      let c = 1;
       
     
      veri[0]=document.getElementById("seri_no_"+c).value;
      veri[1]=document.getElementById("uygunluk_"+c).checked;
      veri[2]=document.getElementById("sicaklik_"+c).value;
      veri[3]=document.getElementById("basinc_"+c).value;
      
      var sel = document.getElementById("sebep_"+c );
      var text= sel.options[sel.selectedIndex].text;
      veri[4]=text;   
    
    veri = JSON.stringify(veri);
    console.log("veri",veri)

    let data = {
      tur : 'havuztest',
      veri : veri
    }
    $.ajax({
          type: "POST",
          url: '/uretimkontrol',
          data : data,
          success: function (x){
            Swal.fire({
              title: 'Başarılı!',
              text: 'Havuz test başarılı bir şekilde eklendi!',
              icon: 'success',
              confirmButtonText: 'Tamam'
            })
          },
          error(err){
            console.log;(err);
          }
        }
      );
  })
</script>

{% endblock %}
